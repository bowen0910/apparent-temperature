<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>體感溫度計算機</title>
<style>
  body {
    background-color: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    padding: 10px;
    max-width: 480px;
    margin: auto;
  }
  h1 {
    color: #FFD700;
    text-align: center;
    margin-bottom: 20px;
    font-size: 24px;
  }
  label {
    display: block;
    margin-top: 8px;
    font-size: 16px;
  }
  input, select {
    width: 100%;
    padding: 6px;
    margin-top: 4px;
    margin-bottom: 8px;
    border-radius: 4px;
    border: none;
    font-size: 16px;
  }
  button {
    background-color: #444;
    color: #fff;
    padding: 10px;
    width: 100%;
    font-size: 18px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover { background-color: #666; }
  #result {
    margin-top: 20px;
    font-size: 24px;
    color: #00FF00;
    text-align: center;
  }
  #note {
    margin-top: 10px;
    font-size: 12px;
    color: #888;
    text-align: center;
  }
  details {
    margin-top: 15px;
    font-size: 12px;
    color: #aaa;
  }
  summary {
    cursor: pointer;
    font-weight: bold;
  }
  #sunTip {
    font-size: 12px;
    color: #888;
    margin-bottom: 6px;
  }
  #precipitationContainer {
    display: none;
  }
</style>
</head>
<body>
<h1>體感溫度計算機</h1>

<label>氣溫:</label>
<input type="number" id="temp" placeholder="請輸入氣溫">
<select id="tempUnit">
  <option value="C">攝氏 (°C)</option>
  <option value="F">華氏 (°F)</option>
</select>

<label>濕度 (%):</label>
<input type="number" id="humidity" placeholder="請輸入濕度">

<label>風速:</label>
<input type="number" id="wind" placeholder="請輸入風速">
<select id="windUnit">
  <option value="ms">m/s</option>
  <option value="kmh">km/h</option>
  <option value="kt">節 (kt)</option>
  <option value="beaufort">蒲式風級</option>
</select>

<label>陣風:</label>
<input type="number" id="gust" placeholder="如有請輸入陣風，無則填0">
<select id="gustUnit">
  <option value="ms">m/s</option>
  <option value="kmh">km/h</option>
  <option value="kt">節 (kt)</option>
  <option value="beaufort">蒲式風級</option>
</select>

<label>天氣情況:</label>
<select id="weather" onchange="togglePrecipitation()">
  <option value="">未選擇</option>
  <option value="night">夜間 (無日照)</option>
  <option value="overcast">陰天</option>
  <option value="cloudy">多雲</option>
  <option value="sunny">晴天</option>
  <option value="strong">強烈日照</option>
  <option value="rain">下雨</option>
  <option value="snow">下雪</option>
</select>
<div id="sunTip">若無法判斷雲量，建議選擇「多雲」。</div>

<div id="precipitationContainer">
  <label id="precipLabel">降雨強度 (mm/hr):</label>
  <input type="number" id="precipIntensity" placeholder="請輸入強度">
</div>

<button onclick="calculate()">計算體感溫度</button>

<div id="result"></div>

<details>
<summary>計算公式</summary>
1. **風速轉換：**<br>
- m/s → m/s : 直接使用<br>
- km/h → m/s : 除以 3.6<br>
- kt → m/s : 乘以 0.514444<br>
- 蒲式風級 → m/s : V = 0.836 × B^(3/2)<br><br>

2. **低溫風寒公式 (T ≤ 15°C)：**<br>
T_cold = T - 0.7 × V_eff - 0.2 × (H/100) × (T - 10)<br>
V_eff = (風速 + 陣風平均) 或只用風速<br><br>

3. **高溫公式 (T ≥ 27°C)：**<br>
Heat Index (簡化版)：T_high = T + 0.33 × (H/100) × T<br><br>

4. **線性過渡區 (15°C < T < 27°C)：**<br>
T_app = w_cold × T_cold + (1 - w_cold) × T_high<br>
w_cold = (27 - T) / 12<br><br>

5. **日照與降水修正依溫度區間：**<br>
- T ≤ 15°C：夜間 0.0°C / 陰天 -0.5°C / 多雲 -0.2°C / 晴天 +0.5°C / 強烈日照 +1.0°C<br>
- 15°C < T < 27°C：夜間 0.0°C / 陰天 +0.5°C / 多雲 +1.5°C / 晴天 +2.5°C / 強烈日照 +4.0°C<br>
- T ≥ 27°C：夜間 0.0°C / 陰天 +0.5°C / 多雲 +1.0°C / 晴天 +1.3°C / 強烈日照 +2.0°C<br><br>

6. **降雨影響 (F_rain)**：<br>
- T ≤ 15°C：F_rain = -0.5 × R_intensity<br>
- 15°C < T < 27°C：F_rain = -0.3 × R_intensity<br>
- T ≥ 27°C：F_rain = 0 (影響微小)<br><br>

7. **降雪影響 (F_snow)**：<br>
- T ≤ 15°C：F_snow = -1 × S_intensity<br>
- 15°C < T < 27°C：F_snow = -0.5 × S_intensity<br>
- T ≥ 27°C：F_snow = -0.2 × S_intensity<br><br>

8. **最終體感溫度計算：**<br>
T_final = T_app + F_precipitation<br>
四捨五入至小數點第一位
</details>

<p id="note">體感溫度僅供參考，實際感受因個人體質、衣著、活動量、日照、降水及風向而有所差異。</p>
<p id="note">製作：夜ゞ無尾熊</p>

<script>
function beaufortToMs(B) {
  return 0.836 * Math.pow(B, 1.5);
}

function windToMs(value, unit) {
  switch (unit) {
    case "ms": return value;
    case "kmh": return value / 3.6;
    case "kt": return value * 0.514444;
    case "beaufort": return beaufortToMs(value);
    default: return value;
  }
}

function heatIndex(T, H) {
  return T + 0.33 * (H / 100) * T;
}

// 控制降雨/降雪輸入欄位顯示
function togglePrecipitation() {
  const weather = document.getElementById("weather").value;
  const container = document.getElementById("precipitationContainer");
  const label = document.getElementById("precipLabel");
  if(weather === "rain"){
    container.style.display = "block";
    label.textContent = "降雨強度 (mm/hr):";
  } else if(weather === "snow"){
    container.style.display = "block";
    label.textContent = "降雪強度 (cm/hr):";
  } else {
    container.style.display = "none";
    document.getElementById("precipIntensity").value = "";
  }
}

function calculate() {
  let missing = [];
  let T = parseFloat(document.getElementById("temp").value);
  const tempUnit = document.getElementById("tempUnit").value;
  const H = parseFloat(document.getElementById("humidity").value);
  let V = parseFloat(document.getElementById("wind").value);
  let G = parseFloat(document.getElementById("gust").value);
  const weather = document.getElementById("weather").value;
  let P = parseFloat(document.getElementById("precipIntensity").value);

  const windUnit = document.getElementById("windUnit").value;
  const gustUnit = document.getElementById("gustUnit").value;

  if(isNaN(T)) missing.push("氣溫");
  if(isNaN(H)) missing.push("濕度");
  if(isNaN(V)) missing.push("風速");
  if((weather==="rain" || weather==="snow") && isNaN(P)) missing.push(weather==="rain"?"降雨強度":"降雪強度");

  if(missing.length > 0){
    document.getElementById("result").textContent = "缺少：" + missing.join("、");
    return;
  }

  // 華氏轉攝氏
  if(tempUnit === "F") T = (T - 32) * 5/9;

  // 風速轉換
  V = windToMs(V, windUnit);
  let useGust = !isNaN(G) && G > 0;
  if(useGust) G = windToMs(G, gustUnit);
  let effectiveWind = useGust ? (V + G) / 2 : V;

  // 低溫與高溫體感
  const T_cold = T - 0.7 * effectiveWind - 0.2 * (H/100) * (T-10);
  const T_high = heatIndex(T, H);
  let T_app;

  if(T <= 15) T_app = T_cold;
  else if(T >= 27) T_app = T_high;
  else {
    const w_cold = (27-T)/12;
    T_app = w_cold * T_cold + (1-w_cold) * T_high;
  }

  // 日照修正
  if(T <= 15){
    switch(weather){
      case "night": T_app += 0.0; break;
      case "overcast": T_app += -0.5; break;
      case "cloudy": T_app += -0.2; break;
      case "sunny": T_app += 0.5; break;
      case "strong": T_app += 1.0; break;
    }
  } else if(T < 27){
    switch(weather){
      case "night": T_app += 0.0; break;
      case "overcast": T_app += 0.5; break;
      case "cloudy": T_app += 1.5; break;
      case "sunny": T_app += 2.5; break;
      case "strong": T_app += 4.0; break;
    }
  } else {
    switch(weather){
      case "night": T_app += 0.0; break;
      case "overcast": T_app += 0.5; break;
      case "cloudy": T_app += 1.0; break;
      case "sunny": T_app += 1.3; break;
      case "strong": T_app += 2.0; break;
    }
  }

  // 降雨/降雪修正
  let F_precip = 0;
  if(weather === "rain"){
    if(T <= 15) F_precip = -0.5 * P;
    else if(T < 27) F_precip = -0.3 * P;
    else F_precip = 0;
  } else if(weather === "snow"){
    if(T <= 15) F_precip = -1 * P;
    else if(T < 27) F_precip = -0.5 * P;
    else F_precip = -0.2 * P;
  }

  let T_final = T_app + F_precip;
  T_final = Math.round(T_final*10)/10;

  document.getElementById("result").textContent = `體感溫度：約 ${T_final} °C`;
}
</script>
</body>
</html>
